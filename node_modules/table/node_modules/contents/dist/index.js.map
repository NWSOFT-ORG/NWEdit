{"version":3,"sources":["../src/index.js"],"names":["Contents","config","contents","eventEmitter","instanceConfig","articles","articleName","articleId","tree","list","link","bind","articleOffsetIndex","lastArticleIndex","windowHeight","guides","querySelectorAll","on","indexOffset","trigger","changeEvent","articleIndex","getIndexOfClosestValue","windowScrollY","current","article","guide","previous","setTimeout","global","window","addEventListener","throttle","innerHeight","document","documentElement","clientHeight","pageYOffset","scrollTop","userConfig","properties","difference","_","Object","keys","length","Error","defaultConfig","assign","HTMLElement","TypeError","element","innerText","textContent","id","uniqueID","inputId","existingIDs","assignedId","i","formattedId","formatId","indexOf","push","querySelector","str","toLowerCase","replace","elements","map","level","name","makeUniqueIDs","uniqueIDpool","lastNode","rootNode","descendants","forEach","findParentNode","findParentNodeWithLevelLower","needle","haystack","parent","createElement","li","appendChild","guideLink","articleLink","href","childNodes","createTextNode","insertBefore","firstChild","tagName","parseInt","slice","dataset","offset","scrollYIndex","j","offsetTop","Math","round","lastClosestValueIndex","closestValueIndex","abs","throttled","threshold","context","deferTimer","last","args","now","Number","Date","clearTimeout","Reflect","apply"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport Sister from 'sister';\n\n/**\n * @param {Object} config\n * @return {Contents}\n */\nconst Contents = (config) => {\n  const contents = {};\n\n  const eventEmitter = Sister();\n\n  const instanceConfig = Contents.config(config);\n\n  const articles = Contents.articles(instanceConfig.articles, instanceConfig.articleName, instanceConfig.articleId);\n  const tree = Contents.tree(articles);\n  const list = Contents.list(tree, instanceConfig.link);\n\n  Contents.bind(eventEmitter, list, instanceConfig);\n\n  /**\n     * @return {HTMLElement} Ordered list element representation of the table of contents.\n     */\n  contents.list = () => {\n    return list;\n  };\n\n  /**\n     * @return {Array} Array representation of the table of contents.\n     */\n  contents.tree = () => {\n    return tree;\n  };\n\n  /**\n     * @return {Sister} Event emitter used to attach event listeners and trigger events.\n     */\n  contents.eventEmitter = () => {\n    return eventEmitter;\n  };\n\n  return contents;\n};\n\n/**\n * Setups event listeners to reflect changes to the table of contents and user navigation.\n *\n * @param {Sister} eventEmitter\n * @param {HTMLElement} list Table of contents root element (<ol>).\n * @param {Object} config Result of contents.config.\n * @return {Object} Result of contents.eventEmitter.\n */\nContents.bind = (eventEmitter, list, config) => {\n  let articleOffsetIndex;\n  let lastArticleIndex = null;\n  let windowHeight;\n\n  const guides = list.querySelectorAll('li');\n\n  eventEmitter.on('resize', () => {\n    windowHeight = Contents.windowHeight();\n    articleOffsetIndex = Contents.indexOffset(config.articles);\n\n    eventEmitter.trigger('scroll');\n  });\n\n  eventEmitter.on('scroll', () => {\n    let changeEvent;\n\n    const articleIndex = Contents.getIndexOfClosestValue(Contents.windowScrollY() + windowHeight * 0.2, articleOffsetIndex);\n\n    if (articleIndex !== lastArticleIndex) {\n      changeEvent = {};\n\n      changeEvent.current = {\n        article: config.articles[articleIndex],\n        guide: guides[articleIndex]\n      };\n\n      if (lastArticleIndex !== null) {\n        changeEvent.previous = {\n          article: config.articles[lastArticleIndex],\n          guide: guides[lastArticleIndex]\n        };\n      }\n\n      eventEmitter.trigger('change', changeEvent);\n\n      lastArticleIndex = articleIndex;\n    }\n  });\n\n  // This allows the script that constructs Contents\n  // to catch the first ready, resize and scroll events.\n  setTimeout(() => {\n    eventEmitter.trigger('resize');\n    eventEmitter.trigger('ready');\n\n    global.window.addEventListener('resize', Contents.throttle(() => {\n      eventEmitter.trigger('resize');\n    }, 100));\n\n    global.window.addEventListener('scroll', Contents.throttle(() => {\n      eventEmitter.trigger('scroll');\n    }, 100));\n  }, 10);\n};\n\n/**\n * @return {number}\n */\nContents.windowHeight = () => {\n  return global.innerHeight || global.document.documentElement.clientHeight;\n};\n\n/**\n * @return {number}\n */\nContents.windowScrollY = () => {\n  return global.pageYOffset || global.document.documentElement.scrollTop;\n};\n\n/**\n * Interpret execution configuration.\n *\n * @param {Object} userConfig\n * @return {Object}\n */\nContents.config = (userConfig = {}) => {\n  const properties = [\n    'articles',\n    'articleName',\n    'articleId',\n    'link'\n  ];\n\n  const difference = _.difference(Object.keys(userConfig), properties);\n\n  if (difference.length) {\n    throw new Error('Unknown configuration property \"' + difference[0] + '\".');\n  }\n\n  const defaultConfig = {\n    articleId: Contents.articleId,\n    articleName: Contents.articleName,\n    articles: global.document.querySelectorAll('h1, h2, h3, h4, h5, h6'),\n    link: Contents.link\n  };\n\n  const instanceConfig = _.assign({}, defaultConfig, userConfig);\n\n  if (!instanceConfig.articles.length || !(instanceConfig.articles[0] instanceof global.window.HTMLElement)) {\n    throw new Error('Option \"articles\" is not a collection of HTMLElement objects.');\n  }\n\n  if (typeof instanceConfig.articleName !== 'function') {\n    throw new TypeError('Option \"articleName\" must be a function.');\n  }\n\n  if (typeof instanceConfig.articleId !== 'function') {\n    throw new TypeError('Option \"articleId\" must be a function.');\n  }\n\n  if (typeof instanceConfig.link !== 'function') {\n    throw new TypeError('Option \"link\" must be a function.');\n  }\n\n  return instanceConfig;\n};\n\n/**\n * Derive article name.\n *\n * This method can be overwritten using config.articleName.\n *\n * @param {HTMLElement} element\n * @return {string}\n */\nContents.articleName = (element) => {\n  return element.innerText || element.textContent;\n};\n\n/**\n * Derive article ID.\n *\n * This method can be overwritten using config.articleId.\n *\n * @param {string} articleName\n * @param {HTMLElement} element\n * @return {string}\n */\nContents.articleId = (articleName, element) => {\n  return element.id || articleName;\n};\n\n/**\n * Make element ID unique in the context of the document.\n *\n * @param {string} inputId\n * @param {Array} existingIDs Existing IDs in the document. Required for markup-contents. (https://github.com/gajus/markdown-contents)\n * @return {string}\n */\nContents.uniqueID = (inputId, existingIDs) => {\n  let assignedId;\n\n  let i = 1;\n\n  const formattedId = Contents.formatId(inputId);\n\n  if (existingIDs) {\n    assignedId = formattedId;\n\n    while (existingIDs.indexOf(assignedId) !== -1) {\n      assignedId = formattedId + '-' + i++;\n    }\n\n    existingIDs.push(assignedId);\n  } else {\n    if (!global.document) {\n      throw new Error('No document context.');\n    }\n\n    assignedId = formattedId;\n\n    while (global.document.querySelector('#' + assignedId)) {\n      assignedId = formattedId + '-' + i++;\n    }\n  }\n\n  return assignedId;\n};\n\n/**\n * Formats text into an ID/anchor safe value.\n *\n * @see http://stackoverflow.com/a/1077111/368691\n * @param {string} str\n * @return {string}\n */\nContents.formatId = (str) => {\n  return str\n    .toLowerCase()\n    .replace(/[ãàáäâ]/g, 'a')\n    .replace(/[ẽèéëê]/g, 'e')\n    .replace(/[ìíïî]/g, 'i')\n    .replace(/[õòóöô]/g, 'o')\n    .replace(/[ùúüû]/g, 'u')\n    .replace(/[ñ]/g, 'n')\n    .replace(/[ç]/g, 'c')\n    .replace(/\\s+/g, '-')\n    .replace(/[^a-z0-9\\-_]+/g, '-')\n    .replace(/-+/g, '-')\n    .replace(/^-|-$/g, '')\n    .replace(/^[^a-z]+/g, '');\n};\n\n/**\n * Generate flat index of the articles.\n *\n * @param {Array} elements\n * @param {Contents.articleName} articleName\n * @param {Contents.articleId} articleId\n * @return {Array}\n */\nContents.articles = (elements, articleName = Contents.articleName, articleId = Contents.articleId) => {\n  return _.map(elements, (element) => {\n    const article = {};\n\n    article.level = Contents.level(element);\n    article.name = articleName(element);\n    article.id = articleId(article.name, element);\n    article.element = element;\n\n    return article;\n  });\n};\n\n/**\n * Makes hierarchical index of the articles from a flat index.\n *\n * @param {Array} articles Generated using Contents.articles.\n * @param {boolean} makeUniqueIDs\n * @param {Array} uniqueIDpool\n * @return {Array}\n */\nContents.tree = (articles, makeUniqueIDs = true, uniqueIDpool = []) => {\n  let lastNode;\n\n  const rootNode = {\n    descendants: [],\n    level: 0\n  };\n\n  const tree = rootNode.descendants;\n\n  _.forEach(articles, (article) => {\n    if (makeUniqueIDs) {\n      article.id = Contents.uniqueID(article.id, uniqueIDpool);\n    }\n    article.descendants = [];\n\n    if (!lastNode) {\n      tree.push(article);\n    } else if (lastNode.level === article.level) {\n      Contents.tree.findParentNode(lastNode, rootNode).descendants.push(article);\n    } else if (article.level > lastNode.level) {\n      lastNode.descendants.push(article);\n    } else {\n      Contents.tree.findParentNodeWithLevelLower(lastNode, article.level, rootNode).descendants.push(article);\n    }\n\n    lastNode = article;\n  });\n\n  return tree;\n};\n\n/**\n * Find the object whose descendant is the needle object.\n *\n * @param {Object} needle\n * @param {Object} haystack\n * @return {HTMLElement}\n */\nContents.tree.findParentNode = (needle, haystack) => {\n  if (haystack.descendants.indexOf(needle) !== -1) {\n    return haystack;\n  }\n\n  let parent;\n  let i = haystack.descendants.length;\n\n  while (i--) {\n    parent = Contents.tree.findParentNode(needle, haystack.descendants[i]);\n\n    if (parent) {\n      return parent;\n    }\n  }\n\n  throw new Error('Invalid tree.');\n};\n\n/**\n * Find the object whose descendant is the needle object.\n * Look for parent (including parents of the found object) with level lower than level.\n *\n * @param {Object} needle\n * @param {number} level\n * @param {Object} haystack\n * @return {HTMLElement}\n */\nContents.tree.findParentNodeWithLevelLower = (needle, level, haystack) => {\n  const parent = Contents.tree.findParentNode(needle, haystack);\n\n  if (parent.level < level) {\n    return parent;\n  } else {\n    return Contents.tree.findParentNodeWithLevelLower(parent, level, haystack);\n  }\n};\n\n/**\n * Generate ordered list from a tree (see tree) object.\n *\n * @param {Array} tree\n * @param {Function} link Used to customize the destination element in the list and the source element.\n * @return {HTMLElement}\n */\nContents.list = (tree, link) => {\n  const list = global.document.createElement('ol');\n\n  _.forEach(tree, (article) => {\n    const li = global.document.createElement('li');\n\n    if (link) {\n      link(li, article);\n    }\n\n    if (article.descendants.length) {\n      li.appendChild(Contents.list(article.descendants, link));\n    }\n\n    list.appendChild(li);\n  });\n\n  return list;\n};\n\n/**\n * This function is called after the table of contents is generated.\n * It is called for each article in the index.\n * Used to represent article in the table of contents and to setup navigation.\n *\n * @todo wrong description\n * @param {HTMLElement} guide An element in the table of contents representing an article.\n * @param {Object} article {level, id, name, element, descendants}\n * @return {undefined}\n */\nContents.link = (guide, article) => {\n  const guideLink = global.document.createElement('a');\n  const articleLink = global.document.createElement('a');\n\n  article.element.id = article.id;\n\n  articleLink.href = '#' + article.id;\n\n  while (article.element.childNodes.length) {\n    articleLink.appendChild(article.element.childNodes[0]);\n  }\n\n  article.element.appendChild(articleLink);\n\n  guideLink.appendChild(global.document.createTextNode(article.name));\n  guideLink.href = '#' + article.id;\n\n  guide.insertBefore(guideLink, guide.firstChild);\n};\n\n/**\n * Extract element level used to construct list hierarchy, e.g. <h1> is 1, <h2> is 2.\n * When element is not a heading, use Contents.level data attribute. Default to 1.\n *\n * @param {HTMLElement} element\n * @return {number}\n */\nContents.level = (element) => {\n  const tagName = element.tagName.toLowerCase();\n\n  if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].indexOf(tagName) !== -1) {\n    return parseInt(tagName.slice(1), 10);\n  }\n\n  if (typeof element.dataset['gajus.contents.level'] !== 'undefined') {\n    return parseInt(element.dataset['gajus.contents.level'], 10);\n  }\n\n  return 1;\n};\n\n/**\n * Produce a list of offset values for each element.\n *\n * @param {NodeList} elements\n * @return {Array}\n */\nContents.indexOffset = (elements) => {\n  let element;\n  let offset;\n  const scrollYIndex = [];\n  let i = 0;\n  const j = elements.length;\n\n  while (i < j) {\n    element = elements[i++];\n\n    offset = element.offsetTop;\n\n    // element.offsetTop might produce a float value.\n    // Round to the nearest multiple of 5 (either up or down).\n    // This is done to help readability and testing.\n    offset = 5 * Math.round(offset / 5);\n\n    scrollYIndex.push(offset);\n  }\n\n  return scrollYIndex;\n};\n\n/**\n * Find the nearest value to the needle in the haystack and return the value index.\n *\n * @see http://stackoverflow.com/a/26366951/368691\n * @param {number} needle\n * @param {Array} haystack\n * @return {number}\n */\nContents.getIndexOfClosestValue = (needle, haystack) => {\n  let lastClosestValueIndex;\n\n  let closestValueIndex = 0;\n  let i = 0;\n\n  const j = haystack.length;\n\n  if (!j) {\n    throw new Error('Haystack must be not empty.');\n  }\n\n  while (i < j) {\n    if (Math.abs(needle - haystack[closestValueIndex]) > Math.abs(haystack[i] - needle)) {\n      closestValueIndex = i;\n    }\n\n    if (closestValueIndex === lastClosestValueIndex) {\n      break;\n    }\n\n    lastClosestValueIndex = closestValueIndex;\n\n    i++;\n  }\n\n  return closestValueIndex;\n};\n\n/**\n * @callback throttleCallback\n * @param {...*} var_args\n */\n\n/**\n * Creates and returns a new, throttled version of the passed function, that, when invoked repeatedly,\n * will only call the original function at most once per every wait milliseconds.\n *\n * @see https://remysharp.com/2010/07/21/throttling-function-calls\n * @param {throttleCallback} throttled\n * @param {number} threshold Number of milliseconds between firing the throttled function.\n * @param {Object} context The value of \"this\" provided for the call to throttled.\n * @returns {Function}\n */\nContents.throttle = (throttled, threshold = 250, context = {}) => {\n  let deferTimer;\n  let last;\n\n  return (...args) => {\n    const now = Number(new Date());\n\n    if (last && now < last + threshold) {\n      clearTimeout(deferTimer);\n      deferTimer = setTimeout(() => {\n        last = now;\n        Reflect.apply(throttled, context, args);\n      }, threshold);\n    } else {\n      last = now;\n      Reflect.apply(throttled, context, args);\n    }\n  };\n};\n\nexport default Contents;\n"],"file":"index.js"}